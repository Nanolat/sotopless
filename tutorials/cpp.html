
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>C++ Tutorial - SoTopless</title>
  <meta name="author" content="">

  
  <meta name="description" content="C++ Tutorial Aug 12th, 2013 Introduction This tutorial provides examples of using SoTopless APIs.
For each function call, you need to check the &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.sotopless.com/tutorials/cpp.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="SoTopless" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43406968-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">SoTopless</a></h1>
  
    <h2>A RESTful Leaderboard Server that Supports 100M Users per Server.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.sotopless.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/tutorials/cpp.html">C++ Tutorial</a></li>
  <li><a href="/tutorials/cpp-api.html">C++ API</a></li>
  <li><a href="/tutorials/rest.html">REST Tutorial</a></li>
  <li><a href="/join-alpha-test">Join Alpha Test</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">C++ Tutorial</h1>
    <p class="meta">








  


<time datetime="2013-08-12T18:19:00-07:00" pubdate data-updated="true">Aug 12<span>th</span>, 2013</time></p>
  </header>
  
  <h1>Introduction</h1>

<p>This tutorial provides examples of using SoTopless APIs.
For each function call, you need to check the return value to make sure it is topl::success. However, this kind of error checking is not shown in this tutorial to keep it short and simple.</p>

<h1>Setup SoTopless on EC2</h1>

<p>You can deploy and start SoTopless server in your EC2 node running Linux by issuing a command in your laptop.</p>

<h2>Prerequisites</h2>

<p>SoTopless supports Windows, Linux, and OSX platform.
Java 6 is required for Java SDK and REST service.</p>

<h2>Unzip the tarball</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ tar xvfz sotopless-1.0.tar.gz
</span><span class='line'>$ cd sotopless-1.0
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<h2>Deploy SoTopless on EC2 (Linux)</h2>

<p>Run deploy-ec2.sh to deploy SoTopless on your EC2 node.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./deploy-ec2.sh -node ec2-123-123-123-123.compute-1.amazonaws.com
</span><span class='line'>SoTopless version 1.0 deployed on ec2-123-123-123-123.compute-1.amazonaws.com.
</span><span class='line'>
</span><span class='line'>$</span></code></pre></td></tr></table></div></figure>


<h2>Deploy SoTopless on Windows</h2>

<p>Unzip the tarball and run bin/sotopless.bat to run the SoTopless server.</p>

<h2>Deploy SoTopless on OSX and Linux</h2>

<p>Unzip the tarball and run bin/sotopless.sh to run the SoTopless server.</p>

<h1>User Management</h1>

<p>To post scores of a user, or get scores and ranks of a user, you need to create the user on SoTopless server. You need to create the user only once, like you sign-up on a web site only once.
After the user is created, you can get the user handle of the created user. The user handle will be used to post scores, to get scores and ranks of the user on a leaderboard.</p>

<h2>Create a User</h2>

<p>Creating a user is simple. Specify an identity of the user such as e-mail, device-id, or GUID. The user::create API gives you a user handle of the created user.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>
</span><span class='line'>user::handle_t user_handle;
</span><span class='line'>
</span><span class='line'>// Create a user with an e-mail. 
</span><span class='line'>user::create("foo.bar@gmail.com", & user_handle);
</span><span class='line'>
</span><span class='line'>// Create a user with a device-id or GUID.
</span><span class='line'>user::create("2b6f0cc904d137be2e1730235f5664094b831186", & user_handle); 
</span><span class='line'>user::create("759bfd0a-2c91-4e45-a35c-779740ac5e77",     & user_handle);</span></code></pre></td></tr></table></div></figure>


<h2>Get a User Handle</h2>

<p>Once a user is created, you can get the handle of the user by calling user::get function.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>
</span><span class='line'>user::handle_t user_handle;
</span><span class='line'>
</span><span class='line'>// Get the user handle by e-mail.
</span><span class='line'>user::get("foo.bar@gmail.com", & user_handle); 
</span><span class='line'>
</span><span class='line'>// Get the user handle by device-id or GUID. 
</span><span class='line'>user::get("2b6f0cc904d137be2e1730235f5664094b831186", & user_handle); 
</span><span class='line'>user::get("759bfd0a-2c91-4e45-a35c-779740ac5e77",     & user_handle);</span></code></pre></td></tr></table></div></figure>


<h1>Leaderboard Management</h1>

<p>You can create multiple leaderboards, post scores of users based on different criteria. For example, you may want to create leaderboards based on users&#8217; countries such as USA, Canada, or Germany. Creating weekly, monthly, and daily leaderboards also requires you to create multiple leaderboards.</p>

<p>Leaderboard management APIs help you to create, get, drop, and purge leaderboards. After creating a leaderboard, you can get the handle of the created leaderboard. The handle will be used to purge, drop a leaderboard. Also it will be used to get scores and ranks of a user, or to get the top N users on a leaderboard.</p>

<p>In case you have monthly, weekly, or daily leaderboards, you can purge those leaderboards regularly to keep the rankings up-to-date.</p>

<h2>Create a Leaderboard</h2>

<p>Following code snippet creates monthly, weekly, and daily leaderboards. After you create the leaderboard, scores posted to the leaderboard is safely stored so that you do not lose any data even on catastropic situations such as power-off or OS crash.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>
</span><span class='line'>leaderboard::handle_t monthly_handle;
</span><span class='line'>leaderboard::handle_t weekly_handle ;
</span><span class='line'>leaderboard::handle_t daily_handle  ;
</span><span class='line'>
</span><span class='line'>leaderboard::create("monthly", & monthly_handle);
</span><span class='line'>leaderboard::create("weekly",  & weekly_handle );
</span><span class='line'>leaderboard::create("daily",   & daily_handle  );</span></code></pre></td></tr></table></div></figure>


<h2>Get a Leaderboard Handle</h2>

<p>Once your leaderboard is created, you can use leaderboard::get function to get the handle of the created leaderboard.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>
</span><span class='line'>leaderboard::handle_t monthly_handle;
</span><span class='line'>leaderboard::handle_t weekly_handle ;
</span><span class='line'>leaderboard::handle_t daily_handle  ;
</span><span class='line'>
</span><span class='line'>leaderboard::get("monthly", & monthly_handle);
</span><span class='line'>leaderboard::get("weekly",  & weekly_handle );
</span><span class='line'>leaderboard::get("daily",   & daily_handle  );</span></code></pre></td></tr></table></div></figure>


<h2>Get the List of Leaderboards</h2>

<p>You can get the list of all created leaderboards by using leaderboard::list function.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>using namespace std;
</span><span class='line'>
</span><span class='line'>std::vector&lt;leaderboard::leaderboard_desc_t> leaderboards;
</span><span class='line'>
</span><span class='line'>leaderboard::list( & leaderboards);
</span><span class='line'>
</span><span class='line'>// The leaderboards vector contains an instance of leaderboard_desc_t for each leaderboard.
</span><span class='line'>for( const leaderboard::leaderboard_desc_t & leaderboard : leaderboards )
</span><span class='line'>{
</span><span class='line'>    cout &lt;&lt; "leaderboard name : " &lt;&lt; leaderboard.identity &lt;&lt; endl;
</span><span class='line'>    cout &lt;&lt; "leaderboard handle : " &lt;&lt; leaderboard.handle &lt;&lt; endl;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<h2>Purge Scores on a Leaderboard</h2>

<p>You can purge leaderboards such as monthly, weekly, and daily ones to keep the rankings up-to-date.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>
</span><span class='line'>// 24 hours converted to milliseconds.
</span><span class='line'>util::timestamp_t one_day_ms = 24 * 60 * 60 * 1000;
</span><span class='line'>
</span><span class='line'>util::timestamp_t a_day_ago   = util::now() - one_day_ms;
</span><span class='line'>util::timestamp_t a_week_ago  = util::now() - 7 * one_day_ms;
</span><span class='line'>util::timestamp_t a_month_ago = util::now() - 30 * one_day_ms;
</span><span class='line'>
</span><span class='line'>leaderboard::purge(monthly_handle, a_day_ago  );
</span><span class='line'>leaderboard::purge(weekly_handle,  a_week_ago );
</span><span class='line'>leaderboard::purge(daily_handle,   a_month_ago);</span></code></pre></td></tr></table></div></figure>


<h2>Drop a Leaderboard</h2>

<p>Dropping a leaderboard is like dropping a table on a database. You will lose all data on the leaderboard to be dropped.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>
</span><span class='line'>leaderboard::drop(monthly_handle); 
</span><span class='line'>leaderboard::drop(weekly_handle ); 
</span><span class='line'>leaderboard::drop(daily_handle  );</span></code></pre></td></tr></table></div></figure>


<h1>Posting and Getting Scores</h1>

<p>Whenever a user achieves a new high score, you post the user&rsquo;s score with the handle of the user and the handle of the leaderboard. While you post the user&rsquo;s score, you can provide a string containing the situation of the user such as game items the user used to clear the stage.</p>

<p>You can get the ranking and score on the leaderboard where you posted the user&rsquo;s score. Also you can get a range of ranking on a leaderboard. For example, you can get the list of users and scores of the top 10 scoreboard by quering the rankings from 1st to 10th.</p>

<p>Also, you may want to remove a score posted by a user. Removing the score posted by a user is supported.</p>

<h2>Post a User Score</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>
</span><span class='line'>const int score = 30290;
</span><span class='line'>const std::string situation = "Black King Sword, White Devil Shield";
</span><span class='line'>const util::timestamp_t now = util::now();    
</span><span class='line'>
</span><span class='line'>score::post(monthly_handle, user_handle, score, situation, now );
</span><span class='line'>score::post(weekly_handle,  user_handle, score, situation, now );
</span><span class='line'>score::post(daily_handle,   user_handle, score, situation, now );</span></code></pre></td></tr></table></div></figure>


<h2>Get User Score and Ranking</h2>

<p>Following code snippet gets a score and a ranking on the weekly leaderboard.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>using namespace std;
</span><span class='line'>
</span><span class='line'>score::rank_desc_t rank_desc;
</span><span class='line'>
</span><span class='line'>score::get(weekly_handle, user_handle, & rank_desc);
</span><span class='line'>
</span><span class='line'>cout &lt;&lt; "ranking : "      &lt;&lt; rank_desc.rank          &lt;&lt; endl;
</span><span class='line'>cout &lt;&lt; "user handle : "  &lt;&lt; rank_desc.user_handle   &lt;&lt; endl;
</span><span class='line'>cout &lt;&lt; "user identity: " &lt;&lt; rank_desc.user_identity &lt;&lt; endl;
</span><span class='line'>cout &lt;&lt; "score : "        &lt;&lt; rank_desc.score         &lt;&lt; endl;
</span><span class='line'>cout &lt;&lt; "situation : "    &lt;&lt; rank_desc.situation     &lt;&lt; endl;
</span><span class='line'>cout &lt;&lt; "time : "         &lt;&lt; rank_desc.when          &lt;&lt; endl;</span></code></pre></td></tr></table></div></figure>


<h2>Remove a User Score</h2>

<p>Following code snippet removes the score posted by a user on monthly, weekly, daily leaderboard.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>
</span><span class='line'>score::remove(monthly_handle, user_handle );
</span><span class='line'>score::remove(weekly_handle,  user_handle );
</span><span class='line'>score::remove(daily_handle,   user_handle );</span></code></pre></td></tr></table></div></figure>


<h2>Get Top N Users</h2>

<p>The following code snippet prints the top 10 scores and users on the weekly leaderboard.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>using namespace topl;
</span><span class='line'>using namespace std;
</span><span class='line'>
</span><span class='line'>std::vector&lt;score::rank_desc_t> top10_scores;
</span><span class='line'>
</span><span class='line'>score::list(weekly_handle, 
</span><span class='line'>            1,  // The starting ranking. Start from 1st ranking. 
</span><span class='line'>            10, // The number of users from the 1st ranking.  
</span><span class='line'>            & top10_scores) );
</span><span class='line'>
</span><span class='line'>for( const score::rank_desc_t & rank : top10_scores )
</span><span class='line'>{
</span><span class='line'>    cout &lt;&lt; "Score : " &lt;&lt; rank.score &lt;&lt; ", Name : " &lt;&lt; rank.user_identity &lt;&lt; endl;
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




  
    <footer>
      <p class="meta">
        
        








  


<time datetime="2013-08-12T18:19:00-07:00" pubdate data-updated="true">Aug 12<span>th</span>, 2013</time>
        
      </p>
      
        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.sotopless.com/tutorials/cpp.html" data-via="" data-counturl="http://www.sotopless.com/tutorials/cpp.html" >Tweet</a>
  
  
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 -  -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sotopless';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.sotopless.com/tutorials/cpp.html';
        var disqus_url = 'http://www.sotopless.com/tutorials/cpp.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
